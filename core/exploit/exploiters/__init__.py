#!/usr/bin/env python3
"""
core.exploit.exploiters - 具体漏洞利用器实现

提供各类漏洞的具体利用逻辑
"""

import logging

from .deserialize_exploiter import DeserializeExploiter, register_deserialize_exploiter
from .idor_exploiter import IDORExploiter, register_idor_exploiter
from .path_traversal_exploiter import PathTraversalExploiter
from .rce_exploiter import RCEExploiter, register_rce_exploiter
from .sqli_exploiter import register_sqli_exploiter
from .ssrf_exploiter import SSRFExploiter, register_ssrf_exploiter
from .ssti_exploiter import SSTIExploiter, register_ssti_exploiter
from .upload_exploiter import FileUploadExploiter, register_upload_exploiter
from .xxe_exploiter import XXEExploiter, register_xxe_exploiter

# 尝试注册所有利用器
_registered_exploiters = []
_logger = logging.getLogger(__name__)

# 定义统一的注册异常处理
_REGISTER_ERRORS = (ImportError, AttributeError, TypeError, ValueError, RuntimeError)

try:
    _sqli = register_sqli_exploiter()
    if _sqli:
        _registered_exploiters.append("sqli")
except _REGISTER_ERRORS:
    _logger.exception("注册 SQLi 利用器失败")

try:
    if PathTraversalExploiter:
        _registered_exploiters.append("path_traversal")
except _REGISTER_ERRORS:
    _logger.exception("注册路径遍历利用器失败")

try:
    _rce = register_rce_exploiter()
    if _rce:
        _registered_exploiters.append("rce")
except _REGISTER_ERRORS:
    _logger.exception("注册 RCE 利用器失败")

try:
    _ssti = register_ssti_exploiter()
    if _ssti:
        _registered_exploiters.append("ssti")
except _REGISTER_ERRORS:
    _logger.exception("注册 SSTI 利用器失败")

try:
    _ssrf = register_ssrf_exploiter()
    if _ssrf:
        _registered_exploiters.append("ssrf")
except _REGISTER_ERRORS:
    _logger.exception("注册 SSRF 利用器失败")

try:
    _xxe = register_xxe_exploiter()
    if _xxe:
        _registered_exploiters.append("xxe")
except _REGISTER_ERRORS:
    _logger.exception("注册 XXE 利用器失败")

try:
    _idor = register_idor_exploiter()
    if _idor:
        _registered_exploiters.append("idor")
except _REGISTER_ERRORS:
    _logger.exception("注册 IDOR 利用器失败")

try:
    _deserialize = register_deserialize_exploiter()
    if _deserialize:
        _registered_exploiters.append("deserialize")
except _REGISTER_ERRORS:
    _logger.exception("注册反序列化利用器失败")

try:
    _upload = register_upload_exploiter()
    if _upload:
        _registered_exploiters.append("file_upload")
except _REGISTER_ERRORS:
    _logger.exception("注册文件上传利用器失败")

__all__ = [
    "register_sqli_exploiter",
    "PathTraversalExploiter",
    "RCEExploiter",
    "register_rce_exploiter",
    "SSTIExploiter",
    "register_ssti_exploiter",
    "SSRFExploiter",
    "register_ssrf_exploiter",
    "XXEExploiter",
    "register_xxe_exploiter",
    "IDORExploiter",
    "register_idor_exploiter",
    "DeserializeExploiter",
    "register_deserialize_exploiter",
    "FileUploadExploiter",
    "register_upload_exploiter",
]
